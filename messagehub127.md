---

copyright:
  years: 2015, 2018
lastupdated: "2018-06-27"

---

{:new_window: target="_blank"}
{:shortdesc: .shortdesc}
{:screen: .screen}
{:codeblock: .codeblock}
{:pre: .pre}


# Connecting to Message Hub
{: #connect_messagehub}

How you connect to your cluster varies according to whether you're using the Standard or Enterprise plan, and also whether you're connecting from a Cloud Foundry application or from any other external client. You need to collect two pieces of information to connect to any of our APIs:

* The endpoint URLs for the APIs
* An API key for authentication

Refer to the instructions below to obtain these:

## Provision a Message Hub instance

It is a prerequisite to first provision a Message Hub service instance. Please make sure you have already done so, noting your plan of choice. Provisioning a Message Hub instance might incur a charge. Next, obtain our API connection details by reading the following information:

## Standard plan:

Services provisioned using the Standard Plan are Cloud Foundry services, which means that they are deployed into a Cloud Foundry organization and space and are grouped in the dashboard under the heading **Cloud Foundry Services**. To connect an application, the method you use depends on where the application is deployed:


### Cloud Foundry applications

Your application must be bound to the Message Hub service instance. When bound, the connection details are then made available to the application in JSON format in the VCAP_SERVICES environment variable. You can bind an application and service using either the IBM Cloud console or the IBM Cloud CLI.

When your application is bound to the {{site.data.keyword.messagehub}} service, details of the service are stored
in JSON format in the VCAP_SERVICES environment variable for your app. Here is an example:

```
{
  "credentials": {
    "mqlight_lookup_url": "https://mqlight-lookup.messagehub.services.us-south.bluemix.net/Lookup?serviceId=584e8436-e7f5-43db-96ac-2864fccae5ae",
    "api_key": "d9JSx1SYsmLzNRbbgUFneDm2DtkedlVeViObYJIvrPAf2kJA",
    "kafka_admin_url": "https://kafka-admin.messagehub.services.us-south.bluemix.net:443",
    "kafka_rest_url": "https://kafka-rest.messagehub.services.us-south.bluemix.net:443",
    "kafka_brokers_sasl": [
      "kafka01.messagehub.services.us-south.bluemix.net:9093",
      "kafka02.messagehub.services.us-south.bluemix.net:9093",
      "kafka03.messagehub.services.us-south.bluemix.net:9093",
      "kafka04.messagehub.services.us-south.bluemix.net:9093",
      "kafka05.messagehub.services.us-south.bluemix.net:9093"
    ],
    "user": "d9JSx1SYsmLzNRbb",
    "password": "gUFneDm2DtkedlVeViObYJIvrPAf2kJA"
  }
}
```

{: codeblock}

The environment variable's content is the same, regardless of the API that you use to connect to {{site.data.keyword.messagehub}}. Your {{site.data.keyword.Bluemix_notm}} app selects the appropriate credentials from the VCAP_SERVICES environment variable, depending on the interface in
 use.
 
Only your first five brokers are listed in VCAP_SERVICES. If you have more than five brokers, use a Kafka client to retrieve the details of your other brokers. 


#### IBM Cloud console

1. Ensure you're in the intended Cloud Foundry organization and space.
2. Locate your Cloud Foundry Application on the Dashboard. If you don't yet have a Cloud Foundry application, you can create one by clicking the **Create Resource** button
3. Click on your application tile.
4. Select **Connections**.
5. Click **Create Connection**.
6. Select the Message Hub service tile you would like to bind to and click **Connect**. You might need to restage your application for the changes to take effect.
7. Click the **Runtime" tab on the left and select the "Environment variables" tab in the center. You can now view your VCAP_SERVICES information. You need to make sure the application parses this from the environment.

#### IBM Cloud CLI

1. Make sure you're in the desired Cloud Foundry organization and space, you can navigate interactively by issuing ibmcloud target -cf
2. Find your app: ibmcloud app list. If you have a manifest file, you can create a new app by running ibmcloud app push
3. Find your service: ibmcloud service list
4. Issue the bind call: ibmcloud service bind <your app's name> <your service's name>
5. Verify that the VCAP_SERVICES environment variable is available in your application runtime. You can do this by calling ibmcloud app env <your app's name>. You need to make sure the application parses this from the environment. You might need to restage your application for the changes to take effect.

### External Applications

For applications running outside Cloud Foundry, credentials are generated by creating a Service Key. When obtained, manually pass the details of the key to your application via mechanisms of your own choice:

#### IBM Cloud console

1. Make sure you're in the intended Cloud Foundry organization and space.
2. Locate your Cloud Foundry Message Hub service on the Dashboard.
3. Click on your service tile.
4. Select **Service Credentials**.
5. Click **New Credential**.
6. Enter the details for your new credential such as name and click **Add**. A new credential appears in the credentials list.
7. By clicking on this credential (view credential), the details are revealed in JSON format.
8. Pass these credentials to your application. Make sure your application parses the details.

#### IBM Cloud CLI

1. Make sure you're in the intended Cloud Foundry organization and space. You can navigate interactively by issuing the following command```ibmcloud target -cf```
2. Find your service: ```ibmcloud service list```
3. Either create a service key as follows: ```ibmcloud service key-create <your service's name> <name of new service key>``` or list all keys with the following command: 
```ibmcloud service keys <your service's name>```
4. Get the details for the key: 
```ibmcloud service key-show <your service's name> <name of service key>``` . This returns the service key details in JSON format.
5. Pass these credentials to your application.Ensure your application parses the details.


Enterprise Plan:

Services provisioned using the Enterprise Plan are grouped in the dashboard under the heading 'Services'. The Enterprise Plan is IAM enabled. You don't need to understand IAM to get started but some knowledge is recommended, should you wish to secure your Message Hub service

In this section, we're going to explain the steps involved in binding your application and/or obtaining Service Keys for your service. Please note that in order to be authorized to create topics, your application or Service Key has to be of Manager access role.

To connect an application, the method used depends on where the application is deployed:
Cloud Foundry Applications

Your application must be bound to the Message Hub service instance. In order to bind a Cloud Foundry Application to a new One Cloud style, non-Cloud Foundry Service, a Cloud Foundry Service Alias is to be created first and this alias is to be referenced from your Cloud Foundry Application when binding.

Once bound, the connection details are then made available to the application in JSON format in the VCAP_SERVICES environment variable. Binding an application and service can be achieved using either the web portal or the IBM Cloud CLI.

#### IBM Cloud console

1. Make sure you're in the desired Cloud Foundry organization and space
2. Locate your Cloud Foundry Application on the Dashboard or create one if you have not got one already by clicking on the "Create Resource" button
3. Click on your application tile
4. Select "Connections"
5. Click "Create Connection"
6. Select the Message Hub service tile you would like to bind to and click "Connect"
7. The above step will create a Cloud Foundry Service Alias for your Message Hub service first and binds your application to this alias afterwards. On the portal, this happens automatically but on the IBM Cloud CLI, this is a separate manual step. You might need to restage your application for the changes to take effect.
8. Click the "Runtime" tab on the left and select the "Environment variables" tab in the center. You can now view your VCAP_SERVICES information. You need to make sure the application parses this from the environment.

#### IBM Cloud CLI

1. Make sure you're in the desired Cloud Foundry organization and space, you can navigate interactively by issuing ibmcloud target -cf
2. Find your app: ```ibmcloud app list```. If you have a manifest file, you can create a new app by running ```ibmcloud app push```. Bewcause the app is not bound to Message Hub yet, it will not be able to establish a connection. Therefore you consider pushing the application with the --no-start parameter to avoid unnecessary connection failures.
3. Find your service using the following command: ```ibmcloud resource service-instances```
4. Create a Cloud Foundry Service Alias: ```ibmcloud resource service-alias-create <alias_name> --instance-name <your service's name>```
5. Issue the bind call to the Service Alias created above: ```ibmcloud service bind <your app's name> <alias_name>```. Alternatively you can update your manifest file and re-push the application.
6. Verify that the VCAP_SERVICES environment variable is available in your application runtime. You can do this by calling ```ibmcloud app env <your app's name>```. Ensure that the application parses this from the environment. You might need to restage your application for the changes to take effect.

### External applications

For applications running outside Cloud Foundry, credentials are generated by creating a Service Key. When obtained, the details of the key then need to be manually passed to your application using mechanisms of your own choice:

#### IBM Cloud console

1. Locate your Message Hub service on the Dashboard.
2. Click on your service tile.
3. Select **Service Credentials**.
4. Click **New Credential**. 
5. Fill in the details for your new credential such as name, role and click "Add". A new credential appears in the credentials list.
6. By clicking on this credential (view credential), the details are revealed in JSON format.
7. Pass these credentials to your application. Make sure your application parses the details.

#### IBM Cloud CLI

1. Find your service: ```ibmcloud resource service-instances```
2. Create a Service Key: ```ibmcloud resource service-key-create <key_name> <key_role> --instance-name <your_service_name>```
3. Print the Service Key: ```ibmcloud resource service-key <key_name>```
4. Pass these credentials to your application. Make sure your application parses the details.

TODO - Karen ==> Charlie gave me the instructions below, however, I'm not sure it's supposed to be in this section as it's not about how to use IBM Cloud but about how to use Kafka? Maybe the section he highlights could be copied over and referenced/linked from here? I think this is too specific...

Charlie said:

"Add some info describing how to take the information made available from above e.g. like the info in the Connecting a client to the Kafka API section of the alpha docs on stage 1? https://console.stage1.bluemix.net/docs/services/MessageHub/messagehub122.html#alpha_about "

















-------------------------------------------------------------------

## {{site.data.keyword.messagehub}} Standard plan 
{: #vcap}

When your application is bound to the {{site.data.keyword.messagehub}} service, details of the service are stored
in JSON format in the VCAP_SERVICES environment variable for your app. Here is an example:

```
{
  "credentials": {
    "mqlight_lookup_url": "https://mqlight-lookup.messagehub.services.us-south.bluemix.net/Lookup?serviceId=584e8436-e7f5-43db-96ac-2864fccae5ae",
    "api_key": "d9JSx1SYsmLzNRbbgUFneDm2DtkedlVeViObYJIvrPAf2kJA",
    "kafka_admin_url": "https://kafka-admin.messagehub.services.us-south.bluemix.net:443",
    "kafka_rest_url": "https://kafka-rest.messagehub.services.us-south.bluemix.net:443",
    "kafka_brokers_sasl": [
      "kafka01.messagehub.services.us-south.bluemix.net:9093",
      "kafka02.messagehub.services.us-south.bluemix.net:9093",
      "kafka03.messagehub.services.us-south.bluemix.net:9093",
      "kafka04.messagehub.services.us-south.bluemix.net:9093",
      "kafka05.messagehub.services.us-south.bluemix.net:9093"
    ],
    "user": "d9JSx1SYsmLzNRbb",
    "password": "gUFneDm2DtkedlVeViObYJIvrPAf2kJA"
  }
}
```

{: codeblock}

The environment variable's content is the same, regardless of the API that you use to connect to {{site.data.keyword.messagehub}}. Your {{site.data.keyword.Bluemix_notm}} app selects the appropriate credentials from the VCAP_SERVICES environment variable, depending on the interface in
 use.
 
Only your first five brokers are listed in VCAP_SERVICES. If you have more than five brokers, use a Kafka client to retrieve the details of your other brokers. 


## {{site.data.keyword.messagehub}} Enterprise plan
{: #enterprise_connect}


To connect to an API in the cluster you need its endpoint URL and an apikey for authentication. You can retrieve these details from IAM using one of the following methods:

### Cloud Foundry application
For a Cloud Foundry application:
1. In the **Connections** tab for the app (on the left), click the **Create connection** button. 
2. Select the instance of the {{site.data.keyword.messagehub}} service that you want to connect to and click **Connect**. Accept the default options. 
3. When the connection is complete, click the **Runtime** tab for the app, then click **Environment variables** to show **VCAP_SERVICES**.

### Console for an external application
From the console for an external application, create a service apikey by using the following **ibmcloud** command: 

```
ibmcloud resource service-key-create name-of-key Manager --instance-name name-of-your-service
``` 

Copy the <code>kafka_brokers_sasl</code>, <code>kafka_admin_url</code>, and <code>apikey</code> fields from the generated information.
Only your first five brokers are listed in VCAP_SERVICES. If you have more than five brokers, use a Kafka client to retrieve the details of your other brokers. 










